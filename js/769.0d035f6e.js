"use strict";(self["webpackChunkpwa_vue_demo"]=self["webpackChunkpwa_vue_demo"]||[]).push([[769],{5769:function(e,t,s){s.r(t),s.d(t,{default:function(){return d}});var r=function(){var e=this,t=e._self._c;return t("div",{staticClass:"container"},[t("div",{staticClass:"h2"},[e._v("下载页!!")]),e.canInstallPWA?t("button",{on:{click:e.downloadClick}},[e._v(e._s(e.progressText))]):e._e()])},o=[],l={name:"StoreView",data(){return{progress:0,intervalId:null,deferredPrompt:null,canInstallPWA:!1}},computed:{progressText(){return this.progress<100?`加载中... ${this.progress}%`:"完成"}},created(){console.log("created")},mounted(){console.log("mounted"),window.addEventListener("beforeinstallprompt",(e=>{console.log("beforeinstallprompt"),e.preventDefault(),this.deferredPrompt=e,this.canInstallPWA=!0,console.log("MMM",this.canInstallPWA)})),window.addEventListener("appinstalled",(()=>{console.log("PWA 已成功安装"),this.installed=!0,this.canInstall=!1}))},methods:{async downloadClick(){if(this.deferredPrompt){this.deferredPrompt.prompt();const{outcome:e}=await this.deferredPrompt.userChoice;"accepted"===e?(console.log("用户接受了 PWA 安装"),this.startFakeProgress()):console.log("用户拒绝了 PWA 安装"),this.deferredPrompt=null}},startFakeProgress(){this.intervalId||(this.progress=0,this.intervalId=setInterval((()=>{this.progress<100?(this.progress+=Math.floor(5*Math.random())+1,this.progress>100&&(this.progress=100)):(clearInterval(this.intervalId),this.intervalId=null,this.canInstallPWA=!1)}),100))}}},n=l,a=s(1656),i=(0,a.A)(n,r,o,!1,null,"8d12421a",null),d=i.exports}}]);
//# sourceMappingURL=769.0d035f6e.js.map