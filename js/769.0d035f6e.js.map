{"version":3,"file":"js/769.0d035f6e.js","mappings":"oKAAA,IAAIA,EAAS,WAAkB,IAAIC,EAAIC,KAAKC,EAAGF,EAAIG,MAAMD,GAAG,OAAOA,EAAG,MAAM,CAACE,YAAY,aAAa,CAACF,EAAG,MAAM,CAACE,YAAY,MAAM,CAACJ,EAAIK,GAAG,WAAYL,EAAIM,cAAeJ,EAAG,SAAS,CAACK,GAAG,CAAC,MAAQP,EAAIQ,gBAAgB,CAACR,EAAIK,GAAGL,EAAIS,GAAGT,EAAIU,iBAAiBV,EAAIW,MAC/P,EACIC,EAAkB,GCOtB,GACAC,KAAA,YACAC,IAAAA,GACA,OACAC,SAAA,EACAC,WAAA,KACAC,eAAA,KACAX,eAAA,EAEA,EACAY,SAAA,CAEAR,YAAAA,GACA,YAAAK,SAAA,mBAAAA,YAAA,IACA,GAEAI,OAAAA,GACAC,QAAAC,IAAA,UAEA,EACAC,OAAAA,GACAF,QAAAC,IAAA,WAIAE,OAAAC,iBAAA,uBAAAC,IACAL,QAAAC,IAAA,uBAGAI,EAAAC,iBAEA,KAAAT,eAAAQ,EAEA,KAAAnB,eAAA,EACAc,QAAAC,IAAA,WAAAf,cAAA,IAIAiB,OAAAC,iBAAA,qBACAJ,QAAAC,IAAA,aACA,KAAAM,WAAA,EACA,KAAAC,YAAA,IAEA,EACAC,QAAA,CACA,mBAAArB,GAEA,QAAAS,eAAA,CAEA,KAAAA,eAAAa,SAEA,cAAAC,SAAA,KAAAd,eAAAe,WACA,aAAAD,GACAX,QAAAC,IAAA,gBACA,KAAAY,qBAEAb,QAAAC,IAAA,gBAGA,KAAAJ,eAAA,IACA,CACA,EACAgB,iBAAAA,GAEA,KAAAjB,aAEA,KAAAD,SAAA,EACA,KAAAC,WAAAkB,aAAA,KACA,KAAAnB,SAAA,KACA,KAAAA,UAAAoB,KAAAC,MAAA,EAAAD,KAAAE,UAAA,EACA,KAAAtB,SAAA,WAAAA,SAAA,OAEAuB,cAAA,KAAAtB,YACA,KAAAA,WAAA,KACA,KAAAV,eAAA,EACA,GACA,KACA,ICtFiQ,I,UCQ7PiC,GAAY,OACd,EACAxC,EACAa,GACA,EACA,KACA,WACA,MAIF,EAAe2B,EAAiB,O","sources":["webpack://pwa-vue-demo/./src/views/store/StoreView.vue","webpack://pwa-vue-demo/src/views/store/StoreView.vue","webpack://pwa-vue-demo/./src/views/store/StoreView.vue?1072","webpack://pwa-vue-demo/./src/views/store/StoreView.vue?21c5"],"sourcesContent":["var render = function render(){var _vm=this,_c=_vm._self._c;return _c('div',{staticClass:\"container\"},[_c('div',{staticClass:\"h2\"},[_vm._v(\"下载页!!\")]),(_vm.canInstallPWA)?_c('button',{on:{\"click\":_vm.downloadClick}},[_vm._v(_vm._s(_vm.progressText))]):_vm._e()])\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n    <div class=\"container\">\r\n        <div class=\"h2\">下载页!!</div>\r\n\r\n        <button v-if=\"canInstallPWA\" @click=\"downloadClick\">{{ progressText }}</button>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n    name: \"StoreView\",\r\n    data() {\r\n        return {\r\n            progress: 0,       // 当前进度值\r\n            intervalId: null,  // 定时器 ID\r\n            deferredPrompt: null, // 保存 beforeinstallprompt 事件对象\r\n            canInstallPWA: false, // 控制按钮的显示\r\n        }\r\n    },\r\n    computed: {\r\n        // 计算属性：根据进度值返回按钮文本\r\n        progressText() {\r\n            return this.progress < 100 ? `加载中... ${this.progress}%` : \"完成\";\r\n        }\r\n    },\r\n    created() {\r\n        console.log(\"created\");\r\n\r\n    },\r\n    mounted() {\r\n        console.log(\"mounted\");\r\n\r\n        // this.startFakeProgress()\r\n        // 监听 beforeinstallprompt 事件\r\n        window.addEventListener('beforeinstallprompt', (e) => {\r\n            console.log(\"beforeinstallprompt\");\r\n\r\n            // 阻止默认行为\r\n            e.preventDefault();\r\n            // 保存事件对象\r\n            this.deferredPrompt = e;\r\n            // 显示安装按钮\r\n            this.canInstallPWA = true;\r\n            console.log(\"MMM\", this.canInstallPWA);\r\n        });\r\n\r\n        // 监听 appinstalled 事件\r\n        window.addEventListener(\"appinstalled\", () => {\r\n            console.log(\"PWA 已成功安装\");\r\n            this.installed = true; // 更新已安装状态\r\n            this.canInstall = false; // 隐藏安装按钮\r\n        });\r\n    },\r\n    methods: {\r\n        async downloadClick() {\r\n            // this.startFakeProgress()\r\n            if (this.deferredPrompt) {\r\n                // 显示安装提示\r\n                this.deferredPrompt.prompt();\r\n                // 等待用户的响应\r\n                const { outcome } = await this.deferredPrompt.userChoice;\r\n                if (outcome === 'accepted') {\r\n                    console.log('用户接受了 PWA 安装');\r\n                    this.startFakeProgress()\r\n                } else {\r\n                    console.log('用户拒绝了 PWA 安装');\r\n                }\r\n                // 清除事件对象\r\n                this.deferredPrompt = null;\r\n            }\r\n        },\r\n        startFakeProgress() {\r\n            // 如果已经在加载，则不重复启动\r\n            if (this.intervalId) return;\r\n\r\n            this.progress = 0; // 重置进度\r\n            this.intervalId = setInterval(() => {\r\n                if (this.progress < 100) {\r\n                    this.progress += Math.floor(Math.random() * 5) + 1; // 增加随机进度\r\n                    if (this.progress > 100) this.progress = 100; // 确保不超过 100\r\n                } else {\r\n                    clearInterval(this.intervalId); // 停止定时器\r\n                    this.intervalId = null;\r\n                    this.canInstallPWA = false;\r\n                }\r\n            }, 100); // 每 100 毫秒更新一次\r\n        }\r\n    }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.container {\r\n    width: 100%;\r\n    height: 100%;\r\n    margin: 0;\r\n}\r\n</style>","import mod from \"-!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./StoreView.vue?vue&type=script&lang=js\"; export default mod; export * from \"-!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./StoreView.vue?vue&type=script&lang=js\"","import { render, staticRenderFns } from \"./StoreView.vue?vue&type=template&id=8d12421a&scoped=true\"\nimport script from \"./StoreView.vue?vue&type=script&lang=js\"\nexport * from \"./StoreView.vue?vue&type=script&lang=js\"\nimport style0 from \"./StoreView.vue?vue&type=style&index=0&id=8d12421a&prod&scoped=true&lang=css\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/@vue/vue-loader-v15/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"8d12421a\",\n  null\n  \n)\n\nexport default component.exports"],"names":["render","_vm","this","_c","_self","staticClass","_v","canInstallPWA","on","downloadClick","_s","progressText","_e","staticRenderFns","name","data","progress","intervalId","deferredPrompt","computed","created","console","log","mounted","window","addEventListener","e","preventDefault","installed","canInstall","methods","prompt","outcome","userChoice","startFakeProgress","setInterval","Math","floor","random","clearInterval","component"],"sourceRoot":""}