{"version":3,"file":"js/914.8a601d95.js","mappings":"mKAAA,IAAIA,EAAS,WAAkB,IAAIC,EAAIC,KAAKC,EAAGF,EAAIG,MAAMD,GAAG,OAAOA,EAAG,MAAM,CAACE,YAAY,aAAa,CAACF,EAAG,MAAM,CAACE,YAAY,MAAM,CAACJ,EAAIK,GAAG,aAAaH,EAAG,MAAM,CAACF,EAAIK,GAAG,YAAYL,EAAIM,GAAGN,EAAIO,iBAAkBP,EAAIQ,KAAMN,EAAG,MAAM,CAACF,EAAIK,GAAG,YAAYL,EAAIS,KAAMT,EAAIU,cAAeR,EAAG,SAAS,CAACS,GAAG,CAAC,MAAQX,EAAIY,gBAAgB,CAACZ,EAAIK,GAAGL,EAAIM,GAAGN,EAAIa,iBAAiBb,EAAIS,KAAMT,EAAIQ,KAAMN,EAAG,SAAS,CAACS,GAAG,CAAC,MAAQX,EAAIc,SAAS,CAACd,EAAIK,GAAG,aAAaL,EAAIS,KAAMT,EAAIQ,KAAMN,EAAG,SAAS,CAACS,GAAG,CAAC,MAAQX,EAAIe,UAAU,CAACf,EAAIK,GAAG,cAAcL,EAAIS,MAC3gB,EACIO,EAAkB,GCUtB,GACAC,KAAA,YACAC,IAAAA,GACA,OACAC,SAAA,EACAC,WAAA,KACAC,eAAA,KACAX,eAAA,EACAF,MAAA,EACAD,cAAA,EAEA,EACAe,SAAA,CAEAT,YAAAA,GACA,YAAAM,SAAA,mBAAAA,YAAA,IACA,GAEAI,OAAAA,GACAC,QAAAC,IAAA,UAEA,EACAC,OAAAA,GACAF,QAAAC,IAAA,WACA,KAAAlB,aAAAoB,OAAAC,WAAA,8BAAAC,QAIAF,OAAAG,iBAAA,uBAAAC,IACAP,QAAAC,IAAA,uBAGAM,EAAAC,iBAEA,KAAAX,eAAAU,EAEA,KAAArB,eAAA,EACAc,QAAAC,IAAA,WAAAf,cAAA,IAIAiB,OAAAG,iBAAA,qBACAN,QAAAC,IAAA,aACA,KAAAjB,MAAA,EACA,KAAAyB,WAAA,EACA,KAAAC,YAAA,IAEA,EACAC,QAAA,CACApB,OAAAA,GACA,MAAAqB,EAAA,iEACAT,OAAAU,SAAAC,KAAAF,CACA,EACAtB,MAAAA,GAEAa,OAAAU,SAAAC,KAAA,uBACA,EACA,mBAAA1B,GAEA,QAAAS,eAAA,CAEA,KAAAA,eAAAkB,SAEA,cAAAC,SAAA,KAAAnB,eAAAoB,WACA,aAAAD,GACAhB,QAAAC,IAAA,gBACA,KAAAiB,qBAEAlB,QAAAC,IAAA,gBAGA,KAAAJ,eAAA,IACA,CACA,EACAqB,iBAAAA,GAEA,KAAAtB,aAEA,KAAAD,SAAA,EACA,KAAAC,WAAAuB,aAAA,KACA,KAAAxB,SAAA,KACA,KAAAA,UAAAyB,KAAAC,MAAA,EAAAD,KAAAE,UAAA,EACA,KAAA3B,SAAA,WAAAA,SAAA,OAEA4B,cAAA,KAAA3B,YACA,KAAAA,WAAA,KACA,KAAAV,eAAA,EACA,GACA,KACA,ICrGiQ,I,UCQ7PsC,GAAY,OACd,EACAjD,EACAiB,GACA,EACA,KACA,WACA,MAIF,EAAegC,EAAiB,O","sources":["webpack://pwa-vue-demo/./src/views/store/StoreView.vue","webpack://pwa-vue-demo/src/views/store/StoreView.vue","webpack://pwa-vue-demo/./src/views/store/StoreView.vue?1072","webpack://pwa-vue-demo/./src/views/store/StoreView.vue?21c5"],"sourcesContent":["var render = function render(){var _vm=this,_c=_vm._self._c;return _c('div',{staticClass:\"container\"},[_c('div',{staticClass:\"h2\"},[_vm._v(\"下载页!!%%\")]),_c('div',[_vm._v(\"是否PWA启动: \"+_vm._s(_vm.isStandalone))]),(_vm.done)?_c('div',[_vm._v(\"已成功安装 \")]):_vm._e(),(_vm.canInstallPWA)?_c('button',{on:{\"click\":_vm.downloadClick}},[_vm._v(_vm._s(_vm.progressText))]):_vm._e(),(_vm.done)?_c('button',{on:{\"click\":_vm.launch}},[_vm._v(\"启动pwa应用\")]):_vm._e(),(_vm.done)?_c('button',{on:{\"click\":_vm.launch2}},[_vm._v(\"启动pwa应用2\")]):_vm._e()])\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n    <div class=\"container\">\r\n        <div class=\"h2\">下载页!!%%</div>\r\n        <div>是否PWA启动: {{ isStandalone }}</div>\r\n        <div v-if=\"done\">已成功安装 </div>\r\n        <button v-if=\"canInstallPWA\" @click=\"downloadClick\">{{ progressText }}</button>\r\n        <button v-if=\"done\" @click=\"launch\">启动pwa应用</button>\r\n        <button v-if=\"done\" @click=\"launch2\">启动pwa应用2</button>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n    name: \"StoreView\",\r\n    data() {\r\n        return {\r\n            progress: 0,       // 当前进度值\r\n            intervalId: null,  // 定时器 ID\r\n            deferredPrompt: null, // 保存 beforeinstallprompt 事件对象\r\n            canInstallPWA: false, // 控制按钮的显示\r\n            done: false,\r\n            isStandalone: false,\r\n        }\r\n    },\r\n    computed: {\r\n        // 计算属性：根据进度值返回按钮文本\r\n        progressText() {\r\n            return this.progress < 100 ? `加载中... ${this.progress}%` : \"完成\";\r\n        }\r\n    },\r\n    created() {\r\n        console.log(\"created\");\r\n\r\n    },\r\n    mounted() {\r\n        console.log(\"mounted\");\r\n        this.isStandalone = window.matchMedia('(display-mode: standalone)').matches;\r\n\r\n        // this.startFakeProgress()\r\n        // 监听 beforeinstallprompt 事件\r\n        window.addEventListener('beforeinstallprompt', (e) => {\r\n            console.log(\"beforeinstallprompt\");\r\n\r\n            // 阻止默认行为\r\n            e.preventDefault();\r\n            // 保存事件对象\r\n            this.deferredPrompt = e;\r\n            // 显示安装按钮\r\n            this.canInstallPWA = true;\r\n            console.log(\"MMM\", this.canInstallPWA);\r\n        });\r\n\r\n        // 监听 appinstalled 事件\r\n        window.addEventListener(\"appinstalled\", () => {\r\n            console.log(\"PWA 已成功安装\");\r\n            this.done = true;\r\n            this.installed = true; // 更新已安装状态\r\n            this.canInstall = false; // 隐藏安装按钮\r\n        });\r\n    },\r\n    methods: {\r\n        launch2() {\r\n            const intentUrl = `intent:/store#Intent;scheme=https;package=com.your.package;end`;\r\n            window.location.href = intentUrl;\r\n        },\r\n        launch() {\r\n            // 跳转到 PWA 的 start_url\r\n            window.location.href = \"web+dzpwademo://store\";\r\n        },\r\n        async downloadClick() {\r\n            // this.startFakeProgress()\r\n            if (this.deferredPrompt) {\r\n                // 显示安装提示\r\n                this.deferredPrompt.prompt();\r\n                // 等待用户的响应\r\n                const { outcome } = await this.deferredPrompt.userChoice;\r\n                if (outcome === 'accepted') {\r\n                    console.log('用户接受了 PWA 安装');\r\n                    this.startFakeProgress()\r\n                } else {\r\n                    console.log('用户拒绝了 PWA 安装');\r\n                }\r\n                // 清除事件对象\r\n                this.deferredPrompt = null;\r\n            }\r\n        },\r\n        startFakeProgress() {\r\n            // 如果已经在加载，则不重复启动\r\n            if (this.intervalId) return;\r\n\r\n            this.progress = 0; // 重置进度\r\n            this.intervalId = setInterval(() => {\r\n                if (this.progress < 100) {\r\n                    this.progress += Math.floor(Math.random() * 5) + 1; // 增加随机进度\r\n                    if (this.progress > 100) this.progress = 100; // 确保不超过 100\r\n                } else {\r\n                    clearInterval(this.intervalId); // 停止定时器\r\n                    this.intervalId = null;\r\n                    this.canInstallPWA = false;\r\n                }\r\n            }, 100); // 每 100 毫秒更新一次\r\n        }\r\n    }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.container {\r\n    width: 100%;\r\n    height: 100%;\r\n    margin: 0;\r\n}\r\n</style>","import mod from \"-!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./StoreView.vue?vue&type=script&lang=js\"; export default mod; export * from \"-!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./StoreView.vue?vue&type=script&lang=js\"","import { render, staticRenderFns } from \"./StoreView.vue?vue&type=template&id=430b7836&scoped=true\"\nimport script from \"./StoreView.vue?vue&type=script&lang=js\"\nexport * from \"./StoreView.vue?vue&type=script&lang=js\"\nimport style0 from \"./StoreView.vue?vue&type=style&index=0&id=430b7836&prod&scoped=true&lang=css\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/@vue/vue-loader-v15/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"430b7836\",\n  null\n  \n)\n\nexport default component.exports"],"names":["render","_vm","this","_c","_self","staticClass","_v","_s","isStandalone","done","_e","canInstallPWA","on","downloadClick","progressText","launch","launch2","staticRenderFns","name","data","progress","intervalId","deferredPrompt","computed","created","console","log","mounted","window","matchMedia","matches","addEventListener","e","preventDefault","installed","canInstall","methods","intentUrl","location","href","prompt","outcome","userChoice","startFakeProgress","setInterval","Math","floor","random","clearInterval","component"],"sourceRoot":""}